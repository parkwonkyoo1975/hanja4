<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ ì´ˆë“± í•„ìˆ˜ í•œì 400</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.0.0/dist/hanzi-writer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        :root { --primary: #9C27B0; --secondary: #FFD700; --bg: #F3E5F5; --point-blue: #2196F3; }
        body { font-family: 'Jua', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: #333; }
        header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--secondary); position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.8rem; color: var(--primary); cursor: pointer; }
        .nav-menu button { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-family: 'Jua'; margin-left: 5px; }
        .page { display: none; padding: 20px; max-width: 800px; margin: auto; }
        .active { display: block; }
        .card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-bottom: 25px; text-align: center; }
        #login-page { text-align: center; padding-top: 100px; }
        .login-input { width: 80%; max-width: 300px; padding: 15px; font-size: 1.5rem; border: 2px solid #ddd; border-radius: 15px; font-family: 'Jua'; text-align: center; margin-bottom: 20px; }
        .section-title { border-left: 5px solid var(--primary); padding-left: 10px; margin-top: 30px; text-align: left; font-size: 1.3rem; }
        .info-label { font-size: 1.8rem; font-weight: bold; margin: 5px 0; }
        .breakdown-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; border-radius: 15px; overflow: hidden; border: 1px solid #eee; }
        .breakdown-table td { border: 1px solid #eee; padding: 20px; text-align: center; }
        .hanja-unit { font-size: 3.5rem; color: var(--primary); font-weight: bold; width: 40%; }
        .meaning-unit { font-size: 1.8rem; color: #444; text-align: left; padding-left: 30px; }
        .step-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #fff; padding: 10px 20px; border-radius: 50px; }
        .btn-step { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-family: 'Jua'; }
        .writer-flex { display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
        .char-box { border: 2px solid #ddd; border-radius: 15px; background: white; padding: 10px; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; position: relative; }
        .quiz-option { display: block; width: 100%; padding: 15px; margin: 10px 0; background: white; border: 2px solid #eee; border-radius: 15px; font-family: 'Jua'; font-size: 1.2rem; cursor: pointer; }
        .btn-action { background: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 15px; font-size: 1.1rem; cursor: pointer; font-family: 'Jua'; margin: 5px; }
        .progress-container { width: 100%; background-color: #eee; border-radius: 10px; margin-bottom: 10px; height: 8px; }
        .progress-fill { height: 100%; background-color: var(--point-blue); border-radius: 10px; width: 0%; transition: 0.3s; }
    </style>
</head>
<body>

<div id="login-page" class="page active">
    <div class="card">
        <h1 style="font-size: 2.5rem; margin-bottom: 30px;">ì´ë¦„ì„ ì…ë ¥í•˜ë©´ 400ë‹¨ì–´ ë„ì „!</h1>
        <input type="text" id="user-name-input" class="login-input" placeholder="ì´ë¦„ ì…ë ¥"><br>
        <button class="btn-action" style="font-size: 1.5rem; padding: 15px 40px;" onclick="handleLogin()">í•™ìŠµ ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="main-content" style="display: none;">
    <header>
        <div class="logo" onclick="location.reload()">ğŸŒŸ ì´ˆë“± í•„ìˆ˜ í•œì 400</div>
        <div id="user-display"><span id="display-name" style="margin-right:10px; font-size:1.1rem; color:#666;"></span><span id="user-pts" style="background: var(--primary); color: white; padding: 5px 12px; border-radius: 10px;">0P</span></div>
        <div class="nav-menu">
            <button onclick="showPage('page1')">í•™ìŠµí•˜ê¸°</button>
            <button onclick="showPage('page2')">ì“°ê¸°ì—°ìŠµ</button>
            <button onclick="showPage('page3')">ë‚´ ë‹¨ì–´ì¥</button>
        </div>
    </header>

    <div id="page1" class="page">
        <div id="study-box">
            <div class="progress-container"><div id="main-progress" class="progress-fill"></div></div>
            <div class="step-bar">
                <button class="btn-step" onclick="changeWord(-1)">â—€ ì´ì „</button>
                <span id="progress-text">1 / 100</span>
                <button class="btn-step" onclick="changeWord(1)">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="card">
                <h1 id="main-word" style="color:var(--point-blue); font-size: 4.5rem; margin: 0 0 10px;"></h1>
                <div id="main-eum" class="info-label" style="color: #FF5722;"></div>
                <div id="main-desc" class="info-label" style="color: #2196F3;"></div>
                <h3 class="section-title">â‘  í•œì ëœ»í’€ì´</h3><table class="breakdown-table"><tbody id="hanja-breakdown"></tbody></table>
                <h3 class="section-title">â‘¡ íšìˆœ ë”°ë¼ë³´ê¸°</h3><div class="writer-flex" id="writer-container"></div><button class="btn-action" style="background:#2196F3;" onclick="playSequence()">ë‹¤ì‹œ ë³´ê¸°</button>
                <h3 class="section-title">â‘¢ í€´ì¦ˆ í’€ê¸°</h3><div id="quiz-content"></div><br><button class="btn-action" style="background:#FF9800; width:100%;" onclick="saveToCollection()">ì˜¤ëŠ˜ì˜ ë‹¨ì–´ ì €ì¥! ğŸ’</button>
            </div>
        </div>
    </div>
    <div id="page2" class="page"><div class="card"><h2>âœï¸ ì§ì ‘ ì¨ë³´ê¸°</h2><div id="target-draw" class="char-box" style="width:240px; height:240px; margin: auto;"></div><p id="quiz-guide" style="font-size:1.5rem; color:var(--primary); margin: 20px 0;">ê¸€ìë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</p><div id="draw-buttons"></div></div></div>
    <div id="page3" class="page"><div class="card"><h2>ğŸ’ ë‚˜ì˜ ìˆ˜ì§‘ ë‹¨ì–´ì¥</h2><div id="collection-list" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;"></div></div></div>
</div>

<script>
    // [ì™„ë²½ ë³´ì •] ì§€ì í•´ì£¼ì‹  ê¸€ìë“¤ì˜ ì• ë‹ˆë©”ì´ì…˜ ë°ì´í„°ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.
    const charMap = {
        'é„•': 'éƒ·', // ì‹œê³¨ í–¥
        'ç”£': 'ç”£', // ë‚³ì„ ì‚°
        'é£®': 'é£²', // ë§ˆì‹¤ ìŒ
        'å§Š': 'å§‰', // ëˆ„ì´ ì
        'æŸ»': 'æŸ¥', // ì¡°ì‚¬í•  ì‚¬
        'ç¡': 'ç ”', // [ì‹ ê·œ] ê°ˆ ì—°: íšìˆœ í™œì„±í™”
        'æ“§': 'æŒ™', // [ì‹ ê·œ] ë“¤ ê±°: íšìˆœ í™œì„±í™”
        'æ±š': 'æ±¡'  // [ì‹ ê·œ] ë”ëŸ¬ìš¸ ì˜¤: íšìˆœ í™œì„±í™”
    };

    const hanjaDic = {
        "æ€": "ìƒê° ì‚¬", "è€ƒ": "ìƒê°í•  ê³ ", "æ„": "ëœ» ì˜", "è¦‹": "ë³¼ ê²¬", "ç†": "ë‹¤ìŠ¤ë¦´ ë¦¬", "ç”±": "ë§ë¯¸ì•”ì„ ìœ ", "åŸ": "ê·¼ì› ì›", "å› ": "ì¸í•  ì¸", "ê²°": "ë§ºì„ ê²°", "çµ": "ë§ºì„ ê²°", "æœ": "ì—´ë§¤ ê³¼",
        "èªª": "ë§ì”€ ì„¤", "æ˜": "ë°ì„ ëª…", "ç™¼": "í•„ ë°œ", "è¡¨": "ê²‰ í‘œ", "è§£": "í’€ í•´", "èª¿": "ê³ ë¥¼ ì¡°", "æŸ»": "ì¡°ì‚¬í•  ì‚¬", "ç¡": "ê°ˆ ì—°", "ç©¶": "ê¶êµ¬í•  êµ¬", "å¯¦": "ì—´ë§¤ ì‹¤",
        "é©—": "ì‹œí—˜ í—˜", "å•": "ë¬¼ì„ ë¬¸", "é¡Œ": "ì œëª© ì œ", "æ±º": "ê²°ë‹¨í•  ê²°", "æ•´": "ê°€ì§€ëŸ°í•  ì •", "æ¯”": "ê²¬ì¤„ ë¹„", "è¼ƒ": "ê²¬ì¤„ êµ", "æ": "ìª¼ê°¤ ì„", "åˆ¤": "íŒë‹¨í•  íŒ", "æ–·": "ëŠì„ ë‹¨",
        "è­‰": "ì¦ê±° ì¦", "ç¶“": "ì§€ë‚  ê²½", "æ¿Ÿ": "ê±´ë„ ì œ", "æ¶ˆ": "ì‚¬ë¼ì§ˆ ì†Œ", "è²»": "ì“¸ ë¹„", "è²¯": "ìŒ“ì„ ì €", "è“„": "ìŒ“ì„ ì¶•", "æŠ•": "ë˜ì§ˆ íˆ¬", "ç¥¨": "í‘œ í‘œ", "é¸": "ê°€ë¦´ ì„ ",
        "æ“§": "ë“¤ ê±°", "æ¬Š": "ê¶Œì„¸ ê¶Œ", "åˆ©": "ì´ë¡œìš¸ ë¦¬", "ç¾©": "ì˜³ì„ ì˜", "å‹™": "í˜ì“¸ ë¬´", "è‡ª": "ìŠ¤ìŠ¤ë¡œ ì", "å¹³": "í‰í‰í•  í‰", "ç­‰": "ë¬´ë¦¬ ë“±", "é“": "ê¸¸ ë„", "å¾·": "ë• ë•",
        "æ­·": "ì§€ë‚¼ ë ¥", "å²": "ì—­ì‚¬ ì‚¬", "å‚³": "ì „í•  ì „", "çµ±": "ê±°ëŠë¦´ í†µ", "æ–‡": "ê¸€ì›” ë¬¸", "åŒ–": "ë  í™”", "ç¥–": "í• ì•„ë¹„ ì¡°", "ä¸Š": "ìœ— ìƒ", "æ°‘": "ë°±ì„± ë¯¼", "ä¿—": "í’ì† ì†",
        "äºº": "ì‚¬ëŒ ì¸", "æ”¿": "ì •ì‚¬ ì •", "åºœ": "ë§ˆì„ ë¶€", "åœ‹": "ë‚˜ë¼ êµ­", "æœƒ": "ëª¨ì¼ íšŒ", "æ³•": "ë²• ë²•", "å¾‹": "ë²•ë¥  ë¥ ", "ç§©": "ì°¨ë¡€ ì§ˆ", "åº": "ì°¨ë¡€ ì„œ", "åŠ": "ë°˜ ë°˜",
        "å¾‘": "ì§€ë¦„ê¸¸ ê²½", "å°": "ì‘ì„ ì†Œ", "æ•¸": "ì…€ ìˆ˜", "åˆ†": "ë‚˜ëˆŒ ë¶„", "æ¨": "ë°€ ì¶”", "æ¸¬": "ì´ ì¸¡", "æ­£": "ë°”ë¥¼ ì •", "æ–¹": "ëª¨ ë°©", "ç›´": "ê³§ì„ ì§", "è§’": "ë¿” ê°",
        "æˆ": "ì´ë£° ì„±", "å°±": "ë‚˜ì•„ê°ˆ ì·¨", "å’Œ": "í™”í•  í™”", "é›†": "ëª¨ì„ ì§‘", "ä¸­": "ê°€ìš´ë° ì¤‘", "å¿—": "ëœ» ì§€", "å‚": "ë“œë¦¬ìš¸ ìˆ˜", "è¡Œ": "ë‹¤ë‹ í–‰", "é¢": "ë‚¯ ë©´", "ç©": "ìŒ“ì„ ì ",
        "é«”": "ëª¸ ì²´", "éŠ³": "ë‚ ì¹´ë¡œìš¸ ì˜ˆ", "å°": "ëŒ€ë‹µí•  ëŒ€", "é‚Š": "ê°€ ë³€", "ç«‹": "ì„¤ ë¦½", "å–®": "í™‘ ë‹¨", "ä½": "ìë¦¬ ìœ„", "åœ°": "ë•… ì§€", "å±¤": "ì¸µ ì¸µ", "çŸ³": "ëŒ ì„",
        "æ®¼": "ê»ì§ˆ ê°", "éœ‡": "ë–¨ë¦´ ì§„", "å¤ª": "í´ íƒœ", "é™½": "ë³• ì–‘", "æ˜Ÿ": "ë³„ ì„±", "åº§": "ìë¦¬ ì¢Œ", "æ±š": "ë”ëŸ¬ìš¸ ì˜¤", "æŸ“": "ë¬¼ë“¤ ì—¼", "ä¿": "ì§€í‚¬ ë³´", "è­·": "ë„ìš¸ í˜¸",
        "è³‡": "ì¬ë¬¼ ì", "æº": "ê·¼ì› ì›", "å¾ª": "ëŒ ìˆœ", "ç’°": "ê³ ë¦¬ í™˜", "ä¸»": "ì£¼ì¸ ì£¼", "ç´ ": "ë°”íƒ• ì†Œ", "æ": "ì¬ëª© ì¬", "èƒŒ": "ë“± ë°°", "æ™¯": "ë³• ê²½", "ç‰©": "ë§Œë¬¼ ë¬¼",
        "äº‹": "ì¼ ì‚¬", "ä»¶": "ë¬¼ê±´ ê±´", "è©±": "ë§ì”€ í™”", "å ´": "ë§ˆë‹¹ ì¥", "ç›®": "ëˆˆ ëª©", "ç« ": "ê¸€ì›” ì¥", "ç¾": "ë‚˜íƒ€ë‚  í˜„", "å¹¸": "ë‹¤í–‰ í–‰", "ç¦": "ë³µ ë³µ", "å¤±": "ìƒì„ ì‹¤",
        "æœ›": "ë°”ë„ ë§", "å¸Œ": "ë°”ë„ í¬", "æ€§": "ì„±í’ˆ ì„±", "æ ¼": "ê²©ì‹ ê²©", "æ„Ÿ": "ëŠë‚„ ê°", "æƒ…": "ëœ» ì •", "ç†±": "ë”ìš¸ ì—´", "å¿": "ì°¸ì„ ì¸", "è€": "ê²¬ë”œ ë‚´", "è¬™": "ê²¸ì†í•  ê²¸",
        "éœ": "ê²¸ì†í•  ì†", "å°Š": "ë†’ì„ ì¡´", "æ•¬": "ê³µê²½í•  ê²½", "è² ": "ì§ˆ ë¶€", "ä¿¡": "ë¯¿ì„ ì‹ ", "è³´": "ì˜ë¢°í•  ë¢°", "èª ": "ì •ì„± ì„±", "é…": "ë‚˜ëˆŒ ë°°", "æ…®": "ìƒê°í•  ë ¤", "å”": "ë„ìš¸ í˜‘",
        "åŒ": "í•œê°€ì§€ ë™", "å…‹": "ì´ê¸¸ ê·¹", "æœ": "ì˜· ë³µ", "åŠª": "í˜ì“¸ ë…¸", "åŠ›": "í˜ ë ¥", "é€†": "ê±°ìŠ¤ë¥¼ ì—­", "å¢ƒ": "ì§€ê²½ ê²½", "é”": "í†µë‹¬í•  ë‹¬", "æ¿€": "ë¬¼ê²°ì¹  ê²©", "åŸº": "í„° ê¸°", "æº–": "í‰í‰í•  ì¤€"
    };

    const rawData = [
        "æ€è€ƒ,ì‚¬ê³ ,ê¹Šì´ ìƒê°í•¨", "æ„è¦‹,ì˜ê²¬,ì–´ë–¤ ì¼ì— ëŒ€í•œ ìƒê°", "ç†ç”±,ì´ìœ ,ê¹Œë‹­ì´ë‚˜ ê·¼ê±°", "åŸå› ,ì›ì¸,ì‚¬ê±´ì˜ ë°œìƒ ì´ìœ ", "çµæœ,ê²°ê³¼,ì¼ì˜ ë§ˆì§€ë§‰ ìƒíƒœ", "èªªæ˜,ì„¤ëª…,ì•Œê¸° ì‰½ê²Œ í’€ì´í•¨", "ç™¼è¡¨,ë°œí‘œ,ë“œëŸ¬ë‚´ì–´ ì•Œë¦¼", "ç†è§£,ì´í•´,ëœ»ì„ ê¹¨ë‹¬ì•„ ì•", "èª¿æŸ»,ì¡°ì‚¬,ìì„¸íˆ ì‚´í´ë´„", "ç¡ç©¶,ì—°êµ¬,ê¹Šì´ ìˆê²Œ ì¡°ì‚¬í•¨",
        "å¯¦é©—,ì‹¤í—˜,ì‹¤ì œë¡œ í•´ ë´„", "ç™¼æ˜,ë°œëª…,ìƒˆë¡œìš´ ê²ƒì„ ë§Œë“¦", "ç™¼ç¾,ë°œê²¬,ëª°ëë˜ ê²ƒì„ ì°¾ì•„ëƒ„", "å•é¡Œ,ë¬¸ì œ,ë‹µì„ êµ¬í•˜ëŠ” ì¼", "è§£æ±º,í•´ê²°,ë¬¸ì œë¥¼ í’€ì–´ì„œ ëëƒ„", "æ•´ç†,ì •ë¦¬,ì§ˆì„œ ìˆê²Œ ë§ì¶¤", "æ¯”è¼ƒ,ë¹„êµ,ì„œë¡œ ëŒ€ì¡°í•¨", "åˆ†æ,ë¶„ì„,ë‚˜ëˆ„ì–´ ì‚´í•Œ", "åˆ¤æ–·,íŒë‹¨,ì˜³ê³  ê·¸ë¦„ì„ ì •í•¨", "è­‰æ˜,ì¦ëª…,ì‚¬ì‹¤ì„ ë°í˜",
        "ç¶“æ¿Ÿ,ê²½ì œ,ìƒì‚°ê³¼ ì†Œë¹„ í™œë™", "æ¶ˆè²»,ì†Œë¹„,ë¬¼ê±´ì„ ì¨ì„œ ì—†ì•°", "è²¯è“„,ì €ì¶•,ëˆì„ ëª¨ì•„ ë‘ ", "æŠ•ç¥¨,íˆ¬í‘œ,ì˜ì‚¬ë¥¼ í‘œë¡œ ë‚˜íƒ€ëƒ„", "é¸æ“§,ì„ ê±°,ëŒ€í‘œë¥¼ ë½‘ëŠ” ì¼", "æ¬Šåˆ©,ê¶Œë¦¬,ì£¼ì¥í•  ìˆ˜ ìˆëŠ” í˜", "ç¾©å‹™,ì˜ë¬´,ë°˜ë“œì‹œ í•´ì•¼ í•  ì¼", "è‡ªç”±,ììœ ,êµ¬ì†ë°›ì§€ ì•ŠëŠ” ìƒíƒœ", "å¹³ç­‰,í‰ë“±,ì°¨ë³„ ì—†ì´ ê°™ìŒ", "é“å¾·,ë„ë•,ì§€ì¼œì•¼ í•  ë„ë¦¬",
        "æ­·å²,ì—­ì‚¬,ì§€ë‚˜ì˜¨ ì‚¶ì˜ ìì·¨", "å‚³çµ±,ì „í†µ,ì´ì–´ì ¸ ë‚´ë ¤ì˜¨ ê´€ìŠµ", "æ–‡åŒ–,ë¬¸í™”,ì‚¶ì˜ ëª¨ë“  ì–‘ì‹", "ç¥–ä¸Š,ì¡°ìƒ,ìœ—ëŒ€ì˜ ì–´ë¥¸", "æ°‘ä¿—,ë¯¼ì†,ë¯¼ê°„ì˜ ê³ ìœ  í’ì†", "äººæ¬Š,ì¸ê¶Œ,ì¸ê°„ì˜ ê¶Œë¦¬", "æ”¿åºœ,ì •ë¶€,ë‚˜ë¼ë¥¼ ë‹¤ìŠ¤ë¦¬ëŠ” ê³³", "åœ‹æœƒ,êµ­íšŒ,ë²•ì„ ë§Œë“œëŠ” ê³³", "æ³•å¾‹,ë²•ë¥ ,ë‚˜ë¼ì˜ ê·œì¹™", "ç§©åº,ì§ˆì„œ,ë°”ë¥¸ ì°¨ë¡€ë‚˜ ìƒíƒœ",
        "åŠå¾‘,ë°˜ê²½,ì›ì˜ ë°˜ì§€ë¦„", "å°æ•¸,ì†Œìˆ˜,1ë³´ë‹¤ ì‘ì€ ìˆ˜", "åˆ†æ•¸,ë¶„ìˆ˜,ì „ì²´ì— ëŒ€í•œ ë¶€ë¶„ì˜ ìˆ˜", "æ¨æ¸¬,ì¶”ì¸¡,ë¯¸ë£¨ì–´ ìƒê°í•¨", "æ­£æ–¹,ì •ë°©,ë°”ë¥¸ ì‚¬ê°í˜•", "ç›´è§’,ì§ê°,ìˆ˜ì§ìœ¼ë¡œ ë§Œë‚˜ëŠ” ê°", "æˆå°±,ì„±ì·¨,ëª©ì ì„ ì´ë£¸", "å’Œè§£,í™”í•´,ë‹¤íˆ¼ì„ ê·¸ì¹˜ê³  í’‚", "é›†ä¸­,ì§‘ì¤‘,í•œê³³ìœ¼ë¡œ ëª¨ìŒ", "æ„å¿—,ì˜ì§€,í•˜ë ¤ëŠ” ë§ˆìŒ",
        "å‚ç›´,ìˆ˜ì§,ë˜‘ë°”ë¡œ ì„¸ì›€", "å¹³è¡Œ,í‰í–‰,ë‚˜ë€íˆ ë‚˜ì•„ê°", "é¢ç©,ë©´ì ,ë°”ë‹¥ì˜ ë„“ì´", "é«”ç©,ì²´ì ,ë¬¼ì²´ì˜ ë¶€í”¼", "éŠ³è§’,ì˜ˆê°,ì§ê°ë³´ë‹¤ ì‘ì€ ê°", "å°è§’,ëŒ€ê°,ë§ˆì£¼ ë³´ëŠ” ê°", "å°é‚Š,ëŒ€ë³€,ë§ˆì£¼ ë³´ëŠ” ë³€", "å¹³é¢,í‰ë©´,í‰í‰í•œ í‘œë©´", "ç«‹é«”,ì…ì²´,ë¶€í”¼ê°€ ìˆëŠ” ëª¨ì–‘", "å–®ä½,ë‹¨ìœ„,ì¬ëŠ” ê¸°ì¤€",
        "åœ°å±¤,ì§€ì¸µ,ìŒ“ì—¬ ìˆëŠ” ë•…ì¸µ", "åŒ–çŸ³,í™”ì„,ëŒì²˜ëŸ¼ êµ³ì€ í”ì ", "åœ°æ®¼,ì§€ê°,ì§€êµ¬ì˜ ê²‰ê»ì§ˆ", "åœ°éœ‡,ì§€ì§„,ë•…ì´ í”ë“¤ë¦¼", "å¤ªé™½,íƒœì–‘,íƒœì–‘ê³„ì˜ ì¤‘ì‹¬ ë³„", "è¡Œæ˜Ÿ,í–‰ì„±,ë³„ ì£¼ìœ„ë¥¼ ë„ëŠ” ì²œì²´", "æ±šæŸ“,ì˜¤ì—¼,ë”ëŸ½ê²Œ ë¬¼ë“¦", "ä¿è­·,ë³´í˜¸,ì˜ ë³´ì‚´í”¼ê³  ì§€í‚´", "è³‡æº,ìì›,ì“¸ëª¨ ìˆëŠ” ì›ë£Œ", "å¾ªç’°,ìˆœí™˜,ëŒê³  ë",
        "ä¸»é¡Œ,ì£¼ì œ,í•µì‹¬ì´ ë˜ëŠ” ì œëª©", "ç´ æ,ì†Œì¬,ê¸€ì˜ ì¬ë£Œ", "èƒŒæ™¯,ë°°ê²½,ë’¤ì— ê¹”ë¦° í™˜ê²½", "äººç‰©,ì¸ë¬¼,ì‚¬ê±´ ì†ì˜ ì‚¬ëŒ", "äº‹ä»¶,ì‚¬ê±´,ì¼ì–´ë‚œ ì¼", "å°è©±,ëŒ€í™”,ì„œë¡œ ì£¼ê³ ë°›ëŠ” ë§", "å ´é¢,ì¥ë©´,ì–´ë–¤ ê´‘ê²½ì´ë‚˜ ë¶€ë¶„", "é¡Œç›®,ì œëª©,ê¸€ì˜ ì´ë¦„", "æ–‡ç« ,ë¬¸ì¥,ìƒê°ì„ ë‹´ì€ ê¸€ì¤„", "è¡¨ç¾,í‘œí˜„,ê²‰ìœ¼ë¡œ ë‚˜íƒ€ëƒ„",
        "å¹¸ç¦,í–‰ë³µ,ê¸°ì˜ê³  ì¦ê±°ìš´ ìƒíƒœ", "å¤±æœ›,ì‹¤ë§,ë°”ë¼ë˜ ì¼ì´ ì•ˆ ë¨", "å¸Œæœ›,í¬ë§,ì•ë‚ ì— ê±°ëŠ” ê¸°ëŒ€", "æ€§æ ¼,ì„±ê²©,ì‚¬ëŒì˜ íƒ€ê³ ë‚œ í’ˆì„±", "æ„Ÿæƒ…,ê°ì •,ëŠë¼ëŠ” ë§ˆìŒ", "ç†±æƒ…,ì—´ì •,ëœ¨ê±°ìš´ ì •ì„±", "å¿è€,ì¸ë‚´,ì°¸ê³  ê²¬ë”¤", "è¬™éœ,ê²¸ì†,ë‚¨ì„ ë†’ì´ê³  ìê¸°ë¥¼ ë‚®ì¶¤", "å°Šæ•¬,ì¡´ê²½,ìš°ëŸ¬ëŸ¬ ê³µê²½í•¨", "è‡ªè² ,ìë¶€,ìŠ¤ìŠ¤ë¡œ ìë‘ìŠ¤ëŸ½ê²Œ ì—¬ê¹€",
        "ä¿¡è³´,ì‹ ë¢°,ë¯¿ê³  ì˜ì§€í•¨", "èª å¯¦,ì„±ì‹¤,ì •ì„±ìŠ¤ëŸ½ê³  ì°¸ë¨", "é…æ…®,ë°°ë ¤,ë‚¨ì„ ë„ì™€ì£¼ë ¤ ë§ˆìŒ ì”€", "å”åŒ,í˜‘ë™,í˜ì„ í•©ì³ ì¼í•¨", "å…‹æœ,ê·¹ë³µ,ì–´ë ¤ì›€ì„ ì´ê²¨ ëƒ„", "åŠªåŠ›,ë…¸ë ¥,ì• ë¥¼ ì¨ì„œ í•¨", "é€†å¢ƒ,ì—­ê²½,ì–´ë ¤ìš´ ì²˜ì§€ë‚˜ ê³ ë‚œ", "é”æˆ,ë‹¬ì„±,ëª©í‘œë¥¼ ë‹¤ ì´ë£¸", "æ„Ÿæ¿€,ê°ê²©,í¬ê²Œ ëŠê»´ ë§ˆìŒì´ ì›€ì§ì„", "åŸºæº–,ê¸°ì¤€,ë¹„êµì˜ ê·¼ê±°ê°€ ë˜ëŠ” í‹€"
    ];

    const hanjaList = rawData.map((item, idx) => {
        const [hanja, eum, desc] = item.split(",");
        return { id: idx + 1, word: hanja, eum: eum, desc: desc };
    });

    let currentUserName = ""; let userData = { points: 0, cards: [], lastIdx: 0 }; let currentIndex = 0; let writers = [];

    function handleLogin() {
        const nameInput = document.getElementById('user-name-input').value.trim();
        if (!nameInput) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
        currentUserName = nameInput;
        const storageKey = 'hanjaMaster_V400_Final_' + currentUserName;
        const saved = localStorage.getItem(storageKey);
        if(saved) userData = JSON.parse(saved);
        else userData = { points: 0, cards: [], lastIdx: 0 };
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        document.getElementById('display-name').innerText = currentUserName + "ë‹˜ ë°˜ê°€ì›Œìš”!";
        showPage('page1'); updateHeader(); loadWord(userData.lastIdx || 0);
    }

    function loadWord(idx) {
        currentIndex = idx; userData.lastIdx = idx; const data = hanjaList[idx];
        document.getElementById('main-word').innerText = data.word;
        document.getElementById('main-eum').innerText = `ìŒ : ${data.eum}`;
        document.getElementById('main-desc').innerText = `ëœ» : ${data.desc}`;
        document.getElementById('progress-text').innerText = `${idx + 1} / 100`;
        document.getElementById('main-progress').style.width = (idx + 1) + "%";

        const breakdownTable = document.getElementById('hanja-breakdown');
        breakdownTable.innerHTML = '';
        [...data.word].forEach(char => {
            const meaning = hanjaDic[char] || "ëœ»í’€ì´ ì¤€ë¹„ì¤‘";
            breakdownTable.innerHTML += `<tr><td class="hanja-unit">${char}</td><td class="meaning-unit">${meaning}</td></tr>`;
        });

        const container = document.getElementById('writer-container');
        container.innerHTML = ''; writers = [];
        [...data.word].forEach((char, i) => {
            const box = document.createElement('div');
            box.className = 'char-box'; box.id = `char-box-${i}`;
            container.appendChild(box);
            // ë³´ì • ë¡œì§ ì ìš©: charMapì— ë“±ë¡ëœ ëŒ€ì²´ ìí˜•ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜ ìƒì„±
            let drawChar = charMap[char] || char; 
            const writer = HanziWriter.create(box.id, drawChar, { width: 120, height: 120, padding: 5, strokeColor: i % 2 === 0 ? '#9C27B0' : '#1A237E' });
            writers.push(writer);
        });
        setTimeout(() => playSequence(), 500);

        const qBox = document.getElementById('quiz-content');
        const wrongIdx = (idx + 13) % 100;
        const options = [data.desc, hanjaList[wrongIdx].desc].sort(() => Math.random() - 0.5);
        qBox.innerHTML = `<p style="font-size:1.4rem; margin-bottom:15px;"><b>${data.word}</b> ì˜ ì˜¬ë°”ë¥¸ ëœ»ì€?</p>`;
        options.forEach((opt, i) => { qBox.innerHTML += `<button class="quiz-option" onclick="checkQuiz(this, '${opt}' === '${data.desc}')">${i+1}. ${opt}</button>`; });

        const drawBtns = document.getElementById('draw-buttons');
        drawBtns.innerHTML = ''; [...data.word].forEach(char => { drawBtns.innerHTML += `<button class="btn-action" onclick="startDraw('${char}')">${char} ì“°ê¸°</button>`; });
        saveData();
    }

    async function playSequence() { for (let writer of writers) { writer.hideCharacter(); await new Promise(r => writer.animateCharacter({ onComplete: r })); } }
    function checkQuiz(btn, isCorrect) { if(isCorrect) { btn.style.background = "#c8e6c9"; userData.points += 10; updateHeader(); alert("ì •ë‹µì…ë‹ˆë‹¤! +10P âœ¨"); } else { btn.style.background = "#ffcdd2"; alert("ë‹¤ì‹œ í™•ì¸í•´ ë³´ì„¸ìš”! ğŸ¤”"); } }
    function startDraw(char) { showPage('page2'); document.getElementById('target-draw').innerHTML = ''; document.getElementById('quiz-guide').innerText = `"${char}"ë¥¼ ìˆœì„œëŒ€ë¡œ ì¨ë³´ì„¸ìš”!`; let drawChar = charMap[char] || char; const dw = HanziWriter.create('target-draw', drawChar, { width: 240, height: 240, showCharacter: false, showHintAfterMisses: 1 }); dw.quiz({ onComplete: () => { userData.points += 20; updateHeader(); alert("ì°¸ ì˜í–ˆì–´ìš”! +20P ğŸ‘"); }}); }
    function saveToCollection() { const word = hanjaList[currentIndex].word; if(!userData.cards.includes(word)) { userData.cards.push(word); userData.points += 50; updateHeader(); alert(`'${word}' ë‹¨ì–´ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤! +50P ğŸ’`); } else alert("ì´ë¯¸ ì €ì¥ëœ ë‹¨ì–´ì…ë‹ˆë‹¤!"); }
    function changeWord(n) { const next = currentIndex + n; if(next >= 0 && next < 100) loadWord(next); }
    function updateHeader() { document.getElementById('user-pts').innerText = userData.points + "P"; saveData(); }
    function saveData() { if(currentUserName) { localStorage.setItem('hanjaMaster_V400_Final_' + currentUserName, JSON.stringify(userData)); } }
    function showPage(pId) { document.querySelectorAll('.page').forEach(p => { if(p.id !== 'login-page') p.classList.remove('active'); }); document.getElementById(pId).classList.add('active'); if(pId === 'page3') renderCards(); }
    function renderCards() { const list = document.getElementById('collection-list'); list.innerHTML = ''; if(userData.cards.length === 0) { list.innerHTML = '<p style="grid-column: 1/3;">ìˆ˜ì§‘í•œ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; } userData.cards.forEach(wordStr => { const data = hanjaList.find(i => i.word === wordStr); if(data) { list.innerHTML += `<div class="card" style="padding:15px; margin:0; border:2px solid var(--secondary);"><h3 style="margin:0; color:var(--point-blue);">${data.word}</h3><p style="margin:5px 0 0; font-size:0.9rem;">${data.desc}</p></div>`; } }); }
</script>
</body>
</html>
